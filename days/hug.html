<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hug Day ü§ó</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            font-family: 'Poppins', sans-serif;
            height: 100vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            overflow: hidden; user-select: none; touch-action: manipulation;
        }

        .back-btn {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; font-weight: bold; color: #d81b60;
            background: rgba(255,255,255,0.8); padding: 8px 15px; border-radius: 20px;
            font-size: 0.9rem;
        }

        .title {
            font-family: 'Fredoka One', cursive; color: #d81b60;
            font-size: 2rem; margin-bottom: 10px; text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
        }

        .status-text {
            font-weight: bold; color: #880e4f; margin-bottom: 20px;
            height: 30px; font-size: 1.1rem; transition: transform 0.1s;
        }

        .meter-container {
            width: 80%; max-width: 300px; height: 50px;
            background: #fff; border: 4px solid #d81b60;
            border-radius: 25px; overflow: hidden; position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, #ff80ab, #ff4081);
            transition: width 0.1s linear;
        }

        .hug-btn {
            margin-top: 50px;
            width: 150px; height: 150px;
            border-radius: 50%; border: none;
            background: radial-gradient(circle at 30% 30%, #ff4081, #c60055);
            color: white; font-family: 'Fredoka One'; font-size: 1.5rem;
            box-shadow: 0 10px 0 #880e4f, 0 20px 20px rgba(0,0,0,0.2);
            cursor: pointer; position: relative;
            transition: transform 0.05s, box-shadow 0.05s;
            -webkit-tap-highlight-color: transparent;
        }
        .hug-btn:active {
            transform: translateY(5px) scale(0.95);
            box-shadow: 0 5px 0 #880e4f, 0 5px 10px rgba(0,0,0,0.2);
        }

        .shake { animation: shake 0.5s infinite; }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            justify-content: center; align-items: center;
            overflow-y: auto; 
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 20px;
            text-align: center; border: 4px solid #d81b60;
            width: 90%; max-width: 350px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; overflow-y: auto;
        }
        @keyframes popIn { from{transform: scale(0.5); opacity:0;} to{transform: scale(1); opacity:1;} }
        
        .modal h1 { color: #d81b60; font-family: 'Fredoka One'; margin: 0 0 10px; font-size: 2rem; }
        
        .reward-img {
            width: 100%; height: auto; border-radius: 15px;
            border: 2px solid #ff80ab; margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .coupon-card {
            background: #ffebee; border: 2px dashed #d81b60;
            padding: 15px; border-radius: 10px; margin-bottom: 15px;
            position: relative;
        }
        .coupon-title { font-weight: 800; color: #ad1457; font-size: 1.2rem; margin-bottom: 5px; }
        .coupon-desc { font-size: 0.9rem; color: #880e4f; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        .btn-primary {
            background: #d81b60; color: white; border: none; padding: 12px;
            border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .btn-secondary {
            background: #ffecb3; color: #ff6f00; border: none; padding: 12px;
            border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
    </style>
</head>
<body>

    <a href="../index.html" class="back-btn">‚Üê Back</a>

    <div class="title">‚ù§Ô∏è HUG METER ‚ù§Ô∏è</div>
    <div class="status-text" id="statusText">Tap to fill!</div>

    <div class="meter-container">
        <div class="fill" id="fill"></div>
    </div>

    <button class="hug-btn" id="btn" onmousedown="squeeze(event)" ontouchstart="squeeze(event)">TAP<br>ME!</button>

    <div class="modal" id="winModal">
        <div class="modal-content">
            <h1>HUG SENT!</h1>
            
            <img src="../hug.jpg" class="reward-img" alt="Us Hugging" onerror="this.src='https://placehold.co/600x400/ff4081/ffffff?text=Imagine+Us+Hugging+Here'">

            <div class="coupon-card">
                <div class="coupon-title">‚ù§Ô∏è HUG COUPON ‚ù§Ô∏è</div>
                <div class="coupon-desc">Valid for one tight hug.<br>No expiry date.</div>
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="downloadCoupon()">üì• Save Coupon</button>
                <button class="btn-secondary" onclick="location.reload()">üîÑ Send Another</button>
            </div>
        </div>
    </div>

    <script>
        let power = 0;
        let isRunning = false;
        let gameLoopId;
        
        const fill = document.getElementById('fill');
        const statusText = document.getElementById('statusText');
        const body = document.body;

        function squeeze(e) {
            if(e) e.preventDefault(); 

            if (!isRunning) {
                startGame();
            }

            let add = 10; 
            if (power > 70) add = 7;
            if (power > 90) add = 4;

            power += add;
            if (power >= 100) {
                power = 100;
                checkWin();
            }
            updateUI();
        }

        function startGame() {
            isRunning = true;
            loop();
        }

        function loop() {
            if (!isRunning) return;

            // --- BALANCED DRAIN LOGIC ---

            let drain = 0.05; 

            if (power > 50) drain = 0.1;
            if (power > 80) drain = 0.15;
            if (power > 95) drain = 0.2; // The "Sprint" to the finish

            power -= drain;
            if (power < 0) power = 0;

            updateUI();
            gameLoopId = requestAnimationFrame(loop);
        }

        function updateUI() {
            fill.style.width = power + '%';

            if (power < 30) {
                statusText.innerText = "Tap faster!";
                statusText.style.color = "#880e4f";
                body.classList.remove('shake');
            } else if (power < 70) {
                statusText.innerText = "Keep going!!";
            } else if (power < 90) {
                statusText.innerText = "ALMOST THERE!";
                statusText.style.color = "#d81b60";
            } else {
                statusText.innerText = "DON'T STOP!!!";
                statusText.style.color = "red";
                body.classList.add('shake');
            }
        }

        function checkWin() {
            if (power >= 100) {
                isRunning = false;
                cancelAnimationFrame(gameLoopId);
                
                document.getElementById('winModal').style.display = 'flex';
                body.classList.remove('shake');
                
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ff0000', '#ff4081']
                });
            }
        }

        // --- COUPON GENERATOR ---
        function downloadCoupon() {
            const canvas = document.createElement('canvas');
            canvas.width = 600;
            canvas.height = 300;
            const ctx = canvas.getContext('2d');

            ctx.fillStyle = "#ffebee";
            ctx.fillRect(0, 0, 600, 300);
            
            ctx.strokeStyle = "#d81b60";
            ctx.lineWidth = 8;
            ctx.setLineDash([15, 10]);
            ctx.strokeRect(20, 20, 560, 260);
            ctx.setLineDash([]); 

            ctx.fillStyle = "#d81b60";
            ctx.font = "bold 50px Arial";
            ctx.textAlign = "center";
            ctx.fillText("‚ù§Ô∏è HUG COUPON ‚ù§Ô∏è", 300, 100);
            
            ctx.fillStyle = "#880e4f";
            ctx.font = "30px Arial";
            ctx.fillText("Valid for: ONE TIGHT HUG", 300, 160);
            
            ctx.font = "italic 20px Arial";
            ctx.fillText("Issuer: Farhan | For: Kusum", 300, 220);
            
            const link = document.createElement('a');
            link.download = 'farhan-hug-coupon.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>